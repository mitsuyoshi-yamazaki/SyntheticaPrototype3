# エネルギー単位定義仕様

## このファイルについて

エネルギー単位の新定義と表記方法について記載します。この定義は16bitアーキテクチャでの制限を考慮し、1024進法を採用しています。

## 基本定義

### エネルギー表現

- **基本単位**: 1E（エネルギー）
- **1024進法表現**:
  - 上位16bit: 1024E単位（2^10）
  - 下位16bit: 1E単位（ただし有効範囲は0-1023）

### 最大値

- 最大エネルギー: 65,535 × 1024 + 1,023 = 67,108,863E
- 16進表記: [0xFFFF][0x03FF]

## 表記法

### 数値表現

```
標準表記: 数値E
例: 1000E, 2048E, 164400E

分割表記: [上位]k[下位]E
例:
- 1024E = [1]k[0]E
- 2048E = [2]k[0]E
- 164400E = [160]k[880]E

16進分割表記: [0xHHHH][0xLLLL]
例:
- 1024E = [0x0001][0x0000]
- 164400E = [0x00A0][0x0370]
```

### 命令実行コスト

```
COMPUTER命令実行コスト:
- 1バイト命令: 1E
- 3バイト命令: 3E
- 4バイト命令: 4E
- 5バイト命令: 5E
- 絶対アドレス命令: 6E
```

## 変換規則

### エネルギー値の分解

```
総エネルギー値からの分解:
上位 = エネルギー値 >> 10  （1024で除算）
下位 = エネルギー値 & 0x3FF （1024で剰余）

例: 164400E
上位 = 164400 >> 10 = 160
下位 = 164400 & 0x3FF = 880
```

### エネルギー値の合成

```
分割値からの合成:
エネルギー値 = (上位 << 10) | (下位 & 0x3FF)

例: [160]k[880]E
エネルギー値 = (160 << 10) | 880 = 164400E
```

## プログラミングでの扱い

### C言語での定義

```c
// エネルギー型（32bit）
typedef uint32_t energy_t;

// エネルギー定数
#define E_KILO      1024U       // 1kE = 1024E
#define E_MAX       67108863U   // 最大エネルギー

// マクロ定義
#define ENERGY_HIGH(e)    ((e) >> 10)
#define ENERGY_LOW(e)     ((e) & 0x3FFU)
#define MAKE_ENERGY(h, l) (((h) << 10) | ((l) & 0x3FFU))
```

### Synthetica Scriptでの扱い

```assembly
; エネルギー値は2つのレジスタで管理
; A: 上位16bit（1024E単位）
; B: 下位16bit（1E単位、有効範囲0-1023）

; 1024Eを加算する例
INC_A       ; 上位を1増加

; 100E加算の例
LOAD_IMM    ; B = 現在の下位
0x64        ; 100
ADD_AB      ; B = B + 100
; キャリー処理が必要な場合は別途実装
```

## よく使用する定数

```
1E     = [0x0000][0x0001]
10E    = [0x0000][0x000A]
100E   = [0x0000][0x0064]
1000E  = [0x0000][0x03E8]
1024E  = [0x0001][0x0000]
10240E = [0x000A][0x0000]
```

## 移行時の注意点

1. **小数の除去**: 従来の0.1E → 1Eのように整数化
2. **定数の再計算**: 全てのエネルギー定数を新単位系で再定義
3. **表示形式**: 1024進法による効率的な表現
4. **精度**: 最小単位1Eでの計算
