# TODO / 実装状況

## このファイルについて

- このファイルには本アプリケーション開発を進めるうえで行うタスクの状態一覧を格納する
- アーキテクチャドキュメント（architecture.md）の実装優先順位に基づいて構成

## タスクの状態

- （なし）未着手
- 🏃‍♀️ 進行中
- ✅ 完了済み
- 🚫 中止
- 😀 人間が行うタスク

---

## マイルストーンなし

- README.md へ現在のスクリーンショットを含むゲーム解説を記載する
- git worktreeのために、localhostのポート番号などを環境変数などで変更できるようにする
- 😀 スクリーンショットのダウンロード機能を追加する
- `docs/coding-guidelines.md` の変更に追従する
  - nullチェック
  - satisfies使用
- 😀 eslintでstrict-boolean-expressionsを設定しているが、 `!` による条件はエラー判定にならない（オブジェクトが `!` によりboolean判定になるからだと思われる）：要調査
- テストをすべて確認することで現状の仕様が仕様書に沿っていることを確認し、また失敗しているテストを修正する

### ユニット挙動を確認・リファクタリング

- 😀 ユニット操作メモリの内容を型に追加
- 😀 ユニット操作の実装を確認・必要なら修正する
- HULLの容量計算に32bit必要
  - ユニット操作メモリを16bitへ拡張する？

### 自己複製エージェントの実行

- ✅ `docs/実装計画/エネルギー消費仕様を調整可能にする.md` を実施する
- ✅ `AssemblerConstructionSystem` は利用されていない？ コンストラクタ引数で `ConstructionParameters` を渡している意味は？ `createHeatParametersFromEnergyParams()` は不要ではないか
- ✅ `EnergyParameters` （世界の法則）と `WorldParameters` （世界の一部分の土地の性質）を分離する
- `SELF_REPLICATOR_PRESET` のパラメータを自己複製可能な最小要素で更新し、エージェントの自己複製を試みる
- ✅ spec-v3/synthetica-script.md の仕様に沿った命令セットになっているか確認する（2025-08-09完了）
- 仕様v3.2.0を元に自己複製コードの再実装（C）
- Cコンパイラの作成
- 自己複製エージェントの再実装

### エージェントのデバッグ機能の追加

- 😀 選択中のエージェントのCOMPUTERの動作を確認できる機能を追加する
- ✅ シミュレーション実行速度を調整可能にする（tick per secondの上限値を設定できるようにする：UIはスライダー等）
- ✅ `GameWorld` がReactコンポーネント（ `GameCanvasPixi` ）に保持されているため、Reactの再描画により `GameWorld` が作り直されてしまうのではないか
- ユニット状態に関するテストが十分にあるか確認する
  - 熱ダメージで瀕死のエージェントが次tickでHULLが消えて、分離した内部ユニットとHULL内容物が世界に追加されているか
  - 仕様の各内容がテストになっているか

## フェーズ1: 基盤 (必須)

### 数学・ユーティリティ

- ✅ Vec2ベクトル演算実装
- ✅ Vec2テスト作成
- ✅ トーラス数学実装（wrapPosition, shortestVector等）
- ✅ トーラス数学テスト作成
- ✅ オブジェクトプール実装のテスト作成

### ゲームループ基盤

- ✅ WorldStateManager実装（tick管理、オブジェクト管理）
- ✅ WorldStateManagerテスト作成
- ✅ World.tick()メソッド実装（外部駆動型）
- ✅ Pixi.js tickerとの統合

### オブジェクトシステム

- ✅ GameObject型定義（円形オブジェクト統一インターフェース）
- ✅ ObjectFactory実装（各種オブジェクト生成）
- ✅ ObjectFactoryテスト作成
- ✅ ObjectIdの生成とユニーク性保証のテスト

---

## フェーズ2: 物理とエネルギー (必須)

### 物理エンジン

- ✅ 空間ハッシュグリッド実装（SpatialHashGrid）
- ✅ 空間ハッシュグリッドテスト作成
- ✅ 衝突検出システム実装（円形オブジェクト専用）
- ✅ 衝突検出テスト作成
- ✅ 反発力計算実装（tanh関数による制限）
- ✅ 反発力計算テスト作成
- ✅ 物理演算統合（位置・速度更新）
- ✅ 物理演算統合テスト作成

### エネルギーシステム

- ✅ EnergyObject実装（エネルギーオブジェクトの定義）
- ✅ EnergyObjectテスト作成
- ✅ エネルギーオブジェクトの生成・結合ロジック実装
- ✅ エネルギー結合テスト作成
- ✅ エネルギーソース実装（10-100E/tick生成）
- ✅ エネルギーソーステスト作成
- ✅ エネルギー収集ロジック実装（HULLによる収集）
- ✅ エネルギー収集テスト作成

### 熱システム

- ✅ 熱拡散セルオートマトン実装
- ✅ 熱拡散テスト作成
- ✅ ノイマン近傍での熱流計算実装
- ✅ 熱流計算テスト作成
- ✅ 熱放射システム実装
- ✅ 熱放射テスト作成

### 方向性力場

- ✅ DirectionalForceField型定義
- ✅ 力場システム実装（LINEAR, RADIAL, SPIRAL）
- ✅ 力場システムテスト作成

---

## フェーズ3: ユニットシステム (必須) ✅ 完了

### 基本ユニット

- ✅ Unit基本インターフェース定義
- ✅ HULL実装（コンテナユニット、エネルギー格納）
- ✅ HULLテスト作成
- ✅ ASSEMBLER実装（構築ユニット）
- ✅ ASSEMBLERテスト作成
- ✅ COMPUTER実装（演算ユニット基本構造）
- ✅ COMPUTERテスト作成

### ユニット動作

- ✅ HULLのエネルギー管理ロジック実装
- ✅ エネルギー管理テスト作成
- ✅ エネルギーシステムのWorld統合
- ✅ ASSEMBLERの構築ロジック実装（コスト計算、進捗管理）
- ✅ 構築ロジックテスト作成
- ✅ ユニット間の回路接続実装
- ✅ 回路接続テスト作成

---

## フェーズ4: Synthetica Script VM (必須)

### VMコア ✅ 完了

- ✅ VMState実装（レジスタ、メモリ、プログラムカウンタ）
- ✅ VMStateテスト作成
- ✅ 命令デコーダ実装
- ✅ 命令デコーダテスト作成
- ✅ 命令実行エンジン実装
- ✅ 命令実行テスト作成

### 基本命令セット ✅ 完了

- ✅ 基本演算命令実装（ADD, SUB, MUL, DIV, MOD）
- ✅ 基本演算命令テスト作成
- ✅ ビット操作命令実装（AND, OR, XOR, NOT, SHL, SHR）
- ✅ ビット操作命令テスト作成
- ✅ 制御フロー命令実装（JMP, JZ, JNZ, JG, JL）
- ✅ 制御フロー命令テスト作成
- ✅ メモリ操作命令実装（LOAD, STORE, LOADR, STORER）
- ✅ メモリ操作命令テスト作成

### スタック操作命令

- ✅ スタック管理実装（スタックポインタ、オーバーフロー検出）
- ✅ スタック操作命令実装（PUSH, POP）
- ✅ スタック操作命令テスト作成

### ユニット制御命令

- ✅ SCAN命令実装（自身のスペック読み取り）
- ✅ SCAN命令テスト作成
- ✅ SCANM命令実装（メモリ複数読み取り）
- ✅ SCANM命令テスト作成
- ✅ ASSEMBLE命令実装（ユニット構築）
- ✅ ASSEMBLE命令テスト作成
- ✅ エネルギー操作命令実装（ENERGY関連）
- ✅ エネルギー操作命令テスト作成

### VM統合 ✅ 完了

- ✅ COMPUTERユニットへのVM統合
- ✅ VM実行サイクル管理（処理能力に応じた実行）
- ✅ VMエラーハンドリング実装
- ✅ VM統合テスト作成

### VM未実装命令（オプション）

以下の命令は自己複製コードでは使用されていないため、実装は任意：

- テンプレートマッチング命令
  - SEARCH_F (0xd0): テンプレートを前方検索
  - SEARCH_B (0xd1): テンプレートを後方検索
  - SEARCH_F_MAX (0xd2): 最大256バイト前方検索
  - SEARCH_B_MAX (0xd3): 最大256バイト後方検索
  - その他テンプレート関連命令

- 32bitエネルギー計算命令
  - ADD_E32 (0xd8): 32bitエネルギー加算
  - SUB_E32 (0xd9): 32bitエネルギー減算
  - CMP_E32 (0xda): 32bitエネルギー比較
  - SHL_E10 (0xdb): 1024進法左シフト
  - SHR_E10 (0xdc): 1024進法右シフト

---

## フェーズ5: レンダリングシステム (必須)

### PixiJS基盤

- ✅ PixiJSレンダラー初期化
- ✅ GameCanvasPixiコンポーネント実装
- ✅ Pixi.js tickerによるシミュレーション駆動
- カスタムViewport実装（パン・ズーム機能）
- Viewportテスト作成

### 描画実装

- ✅ ゲームオブジェクト描画（円形、色分け）
- ✅ エネルギーソース描画
- ✅ デバッグ情報表示（FPS、tick数）
- ユニット種別ごとの視覚表現実装
- 熱マップオーバーレイ実装
- 力場可視化実装

### 最適化

- 可視範囲カリング実装
- LODシステム実装（遠距離オブジェクトの簡略表示）
- バッチレンダリング最適化
- 描画パフォーマンステスト作成

---

## フェーズ6: UI実装 (必須)

### 基本UI

- 一時停止/再開ボタン実装
- シミュレーション速度調整スライダー実装
- FPS/統計情報表示実装
- ズーム/パンコントロール実装

### パラメータエディタ

- WorldParametersエディタUI実装
- リアルタイムパラメータ反映実装
- パラメータプリセット機能実装
- パラメータ保存/読み込み機能

### デバッグツール

- オブジェクトインスペクター実装（クリックで詳細表示）
- VMステートビューア実装（COMPUTER内部状態表示）
- パフォーマンスモニター実装
- 空間ハッシュグリッド可視化

---

## フェーズ7: エージェント実装 (必須)

### サンプルエージェント

- 静止エージェント実装（エネルギー収集のみ）
- 自己修復エージェント実装
- ✅ 基本的なエージェント定義（AgentDefinition）
- v3.0.0準拠の自己複製エージェント実装
- v3.1.0準拠の自己複製エージェント実装（プリミティブ命令使用）
  - 現在のVM実装で自己複製コード（docs/spec-v3/agent-code/v3.1.0/constructor-based-replication.md）は実行可能（2025-08-09確認済み）

### エージェントローダー

- エージェント定義のバリデーション実装
- 初期配置ロジック実装
- 複数エージェント同時投入機能

---

## フェーズ8: 統合・最適化 (オプション)

### パフォーマンス最適化

- 10,000オブジェクト時のパフォーマンステスト
- メモリ使用量プロファイリング
- 計算ボトルネック特定と最適化
- WebWorker導入検討

### 品質保証

- E2Eテスト実装
- 統合テストスイート拡充
- エラーハンドリング強化
- ログシステム実装

---

## その他のタスク

### ドキュメント

- 😀 APIドキュメント作成
- 😀 エージェント作成ガイド作成
- 😀 Synthetica Script言語リファレンス作成

### インフラ

- ✅ Vercelデプロイ設定
- ✅ GitHub Actions CI設定
- 😀 パフォーマンスベンチマーク環境構築

---

## 完了済みタスク（アーカイブ）

- ✅ `GameWorld.constructor()` にデモ用のForceField生成処理が書かれているので、アプリケーション層へ移す
- ✅ ビルドエラーを解消
- ✅ `docs/実装計画/描画メソッドの統合.md` を実施
- ✅ `docs/実装計画/Agents.stories.tsxへargを追加.md` を実施
- ✅ `docs/coding-guidelines.md` の const over function 違反の修正
- ✅ エージェントの外観の調整
- ✅ Next.js + TypeScript + Tailwind CSSの基本セットアップ
- ✅ p5.jsインスタンスモード統合
- ✅ GameWorldクラス基本実装
- ✅ GameCanvasコンポーネント（ゲームループ付き）
- ✅ Jest + ESLint + Prettierによるテスト・品質管理環境
- ✅ 静的エクスポート設定
- ✅ GitHub Actions CIパイプライン設定
- ✅ コミットワークフローとコミットノート機能
- ✅ GitHub Issue/PR作成時のAI識別機能
- ✅ 実装アーキテクチャ設計
- ✅ 描画ライブラリ選定（p5.js→PixiJS）
- ✅ ゲームエンジンコア実装
- ✅ GameLoop実装後、Pixi.js ticker駆動に変更
- ✅ オブジェクトをクリックすると、ホバーでオブジェクトの状態を表示する小さなウィンドウが出るようにする
  - 最終的には全てのオブジェクトに対応させるが、現状では対応するのはHULLのみで良い。表示内容は 使用中容量（%）, エネルギー格納量, 接続ユニット種別 である
