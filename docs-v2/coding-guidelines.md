## このファイルについて

- 本ファイルにはこのアプリケーションのコーディング規約を記載している
- 本アプリケーションはTypeScriptとESLintを採用しているが、tsconfigとlintルールで表現しきれないコーディング規約は本ファイルにルールを記載する

## Claudeへの指示

- ソースコードを作成・編集する際は、tsconfigやlintルールで規定されたルールに従うこと。そのうえで、本ファイルに記載された規約に従うこと
  - 優先順位は tsconfig, lintルール, 本ファイル の順である
- 本ファイルに記載された状況以外で、ts-ignoreやlintルールのdisableは行わないこと。disableすることが適当と考えられる場合は、人間に指示を仰ぐこと

## コーディング規約

### 一般

- 型によってデータ構造を表現する
  - 各型が持つべきデータは、その型定義に直接含める
  - 実行時の条件分岐ではなく、コンパイル時の型チェックで誤りを検出できるようにする
  - 異なるデータ構造をひとつの型で扱いたい場合は、SwiftのassociatedType持ちEnumや、TypeScriptのUnion型など、静的に分離可能な合成型を用いる
  - 構造的に等しくとも相互の代入を行わない型はNominal Typeを用いる
    - 主に対象とするのは、演算に用いない値（IDなど）や、同じ型同士での演算を主目的とする値（金融関連の値）などである
    - 物理量などの、別単位の値との演算を主に用いる用途の型は、演算対象を一意に定められないため、通常の数値型で表現する
- インスタンスメンバや変数は可能な限りimmutableにする
- 複数のスコープを一度に抜ける以外の目的で例外を使用しない
- 早期returnを推奨する
- ドキュメント、コメント、テストケース名は日本語を用いる
- パフォーマンスがアプリケーションの動作に影響を与えない限り、パフォーマンスより本規約を優先する
- コレクション要素のイテレーションを行う際は、目的に合わせた関数を使用する
  - 要素に変更を加えた新たなコレクションを得る場合: `map()`
  - コレクションおよび要素に変更を加えず副作用を行う場合: `forEach()`
  - 要素をフィルタした新たなコレクションを得る場合: `filter()`
  - 集約を目的とする場合: `reduce()`

### TypeScript

- 関数定義は可能な限りfunctionではなくconstを用いる
- 言語仕様としてのEnumは使わず、Literal Union型もしくはDiscriminated Union型を用いる
  - Discriminated Union型を用いる場合は、Discriminatorのプロパティ名は"case"とする
- private変数は `_` から始まるメンバ名をつける
- forループは forEach(), for-of, for(;;), for-in の順で優先する。for-inは他の手段で実現できない場合を除いて使用しない
  - **forEach**: 配列の各要素に対して副作用を実行する場合に使用。配列や要素を変更しない意図を明確に表現できる。コールバック関数の第二引数でインデックスにアクセス可能。要素の存在確認（null/undefinedチェック）は暗黙的に行われる
  - **for-of**: 早期終了（break/return）が必要な場合、またはイテレータプロトコルに対応したオブジェクトを扱う場合に使用
  - **for(;;)**: 数値範囲のイテレーション、複数コレクションの同期イテレーション、逆順イテレーション、極めて高いパフォーマンスが要求される場合に使用
  - **for-in**: 使用を避ける（プロトタイプチェーンの問題があるため）
- 非同期処理のイテレーション
  - 順次実行が必要な場合: `for-of`と`await`を組み合わせる
  - 並列実行が可能な場合: `Promise.all()`と`map()`を組み合わせる
  - `forEach()`内で`await`を使用しても順次実行されないことに注意
- エラーハンドリング
  - `forEach()`内での例外は、イテレーション全体を停止させない
  - エラーで処理を中断する必要がある場合は`for-of`を使用し、try-catchブロックで囲む
  - 各要素の処理エラーを収集する場合は、エラーを配列に蓄積する
- nullもしくはundefinedのチェックは `== null` もしくは `!= null` で行う
- `as` 以外で実現できない場合を除いて `satisfies` を用いる

### コメント

- 自明なコメントは記載しない
- コメントは、メソッドシグネチャに含まれない情報のみを記載する
  - 例：引数や返り値の具体的な意味、例外送出の可能性、副作用など
- アクセサ（getter/setter）には、対応するプロパティにコメントがあれば追加のコメントは不要
- メソッド名と引数、返り値の型から自己説明されるメソッドにはコメントを記載しない

## テスト

- テストファイルはそのテスト対象と同じディレクトリ階層に、 <テスト対象ファイル名>.test.ts のファイル名で作成する
- `it()` ではなく `test()` を用いる
