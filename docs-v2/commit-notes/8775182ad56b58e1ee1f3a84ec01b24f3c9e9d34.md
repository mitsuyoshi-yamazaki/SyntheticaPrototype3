# コミットノート - 8775182ad56b58e1ee1f3a84ec01b24f3c9e9d34

## ユーザープロンプト

```
TODO.md の 熱拡散システムの詳細定義 を行う

tickにおける熱の処理は以下の順序で行われる
1. ゲームオブジェクトの活動により、そのオブジェクトの存在する位置のセルに熱量が追加される
2. 熱の拡散・平衡化
3. 放熱

1に関しては特記事項はない

2の熱の拡散・平衡化はセルオートマトン計算により行われる
このセルオートマトンは、各セルが熱量の値をもち、また系の熱の総量が（セルオートマトン計算以外の、1, 3の処理を除けば）常に一定となる性質を持つ
これを実現するために、t+1のセルの熱量を求める計算は、自セルと隣接セルの間の熱量のやり取りを計算することによって求める。なお、隣接するセルは四方のセル（ノイマン近傍）である

熱量のやり取りは、以下の要件を満たす適当な計算を定めよ
- `floor(自セルの熱量 / 4)` と `floor(隣接セルの熱量 / 4)`を比較してその差を埋める方向に熱量が移動する
- 移動する熱量は、熱量の差が大きいほど大きくなる
- 移動する熱量は、tickあたり `floor(自セルの熱量 / 4)` と `floor(隣接セルの熱量 / 4)` の差の半分未満である

3. 放熱 は、すべてのセルから一定量の熱量を取り除くことによって行われる
熱量は、そのセルが、 `floor(そのセルの熱量 * 9/10)` の熱量のセルと隣接している場合にセルオートマトンのルールで流出する熱量、とする
```

続いて：

```
game-world-requirement.md の熱の仕様の記述を必要があれば更新し、 heat-diffusion-system.md への参照を追加せよ
```

続いて：

```
ルートディレクトリのCLAUDE.mdの ユーザー指示を受けてファイルを変更した場合 を実行せよ
```

## 実施内容

熱拡散システムの詳細仕様を定義し、関連ファイルを更新しました。

### 1. heat-diffusion-system.mdの作成

以下の仕様を定義：

- **熱処理フロー**
  - 熱の発生（エネルギー消費 = 熱発生）
  - 熱の拡散・平衡化（セルオートマトン）
  - 放熱（環境への熱放出）

- **熱拡散アルゴリズム**
  - ノイマン近傍（4方向）での熱交換
  - 基準熱量 = floor(熱量/4)
  - 移動熱量 = floor(熱量差/3)、ただし差の半分未満に制限
  - 熱量保存則を維持する実装

- **放熱メカニズム**
  - 仮想環境温度 = floor(現在熱量 × 9/10)
  - 環境との熱交換として計算
  - 漸近的な冷却特性

- **実装詳細**
  - 同期更新（全セル同時）
  - 負の熱量防止
  - パフォーマンス最適化手法
  - 完全な実装例を含む

### 2. game-world-requirement.mdの更新

以下の箇所にheat-diffusion-system.mdへの参照を追加：

- tick処理の熱処理フェーズ（122-123行目）
- 熱[Heat]セクション（162行目付近）

### 3. TODO.mdの更新

- 「熱拡散システムの詳細定義」タスクを完了に変更
- 詳細説明を更新（実装内容を明記）
