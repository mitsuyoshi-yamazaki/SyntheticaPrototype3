# コミット aa28d15 の指示内容

## ユーザーからの指示

src/engine/vm-stack.test.ts の 一時保存と復元 のテストが失敗する原因を解明せよ

## 実施内容

VMスタックテストの「一時保存と復元」テストが失敗していた原因を調査し、修正を実施。

### 問題の原因
- テストコードが5バイト命令（LOAD_IMM、LOAD_IMM_B）のフォーマットを誤って記述していた
- 仕様では第2,3バイトに16bit即値を配置するが、テストでは第4,5バイトに配置していた
- また、削除済みの命令（MOV_A_IMM等）を使用していた箇所があった

### 修正内容
1. `一時保存と復元`テストで、LOAD_IMM/LOAD_IMM_B命令の即値を正しい位置（第2,3バイト）に配置
2. `関数呼び出しパターン`テストで、削除済み命令を既存のMOV命令に置き換え
3. vm-decoder.tsにコメントを追加して仕様を明確化

### 結果
全てのスタックテストが成功するようになった。