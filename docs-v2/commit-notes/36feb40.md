# コミットノート: 36feb40

## ユーザー指示

src/engine/vm-instructions.test.ts の冒頭に記載されているコメントの「## Claudeへの指令」および「## テスト実装方法」を読み、行う内容を確認せよ

その後、作業を進めよ

## 実施内容

VM命令テストの修正と改善を実施：

1. 既存テストのsp期待値を修正
   - VMState(0x10)の場合: sp=0x0f
   - VMState(0x100)の場合: sp=0xff
   - POP命令のテストでスタック操作後の値も修正

2. 命令コードとdescribe名を大文字に統一
   - 0x0A-0x0E (MOV_CA, MOV_CD, MOV_DC, MOV_SP, SET_SP)
   - 0x1A-0x1F (XOR_AB, AND_AB, OR_AB, NOT_A, CMP_AB, PUSH_A)
   - 0x2E-0x2F (POP_A, POP_B)
   - 0xE0-0xE1 (LOAD_IMM, LOAD_IMM_B)
   - 0xF0 (NOP5)

3. MOV_SPテストの期待値を修正
   - スタックポインタの値を正しく反映（0xffff → 0x0f）

4. 5バイト命令テストの改善
   - LOAD_IMM, LOAD_IMM_B, NOP5テストをexpectVMState()ヘルパー関数を使用するよう改善
   - 実行前後の全状態を検証するように修正