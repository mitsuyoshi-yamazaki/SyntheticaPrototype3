# コミットノート: 38c77714bb30ec45e6b45de78e7d7b4e0036d945

## ユーザープロンプト

現在実装されている命令セットが、docs/spec-v3/synthetica-script.md に記載の仕様と一致しているか確認せよ

## 実行内容

VM命令セットの完全な仕様準拠への更新作業を実施：

### 主要変更

1. **vm-instructions.ts の完全書き換え**
   - docs/spec-v3/synthetica-script.md に完全準拠
   - 1/3/4/5バイト命令カテゴリに整理
   - 新命令タイプ追加：TEMPLATE、ENERGY

2. **vm-executor.ts の新命令セット対応**
   - LOAD_IMM (0xE0) 実装追加
   - RET (0xB2) をCレジスタベースに変更
   - SHL/SHR (0xC2/0xC3) のキャリーフラグとシフト処理修正
   - executeTemplate、executeEnergy メソッド追加

3. **vm-decoder.ts の5バイト命令対応**
   - LOAD_IMM、LOAD_IMM_B の即値デコード実装
   - 旧3バイト即値命令（MOV_A_IMM等）の削除

4. **テストファイル更新**
   - vm-executor.test.ts を新オペコードに更新
   - LOAD_ABS: 0x80→0xA0、JMP_ABS: 0x90→0xB1 等
   - RETテスト をスタックベースからCレジスタベースに変更
   - 無限ループテストの修正

5. **opcode-migration-map.md 作成**
   - 旧→新オペコード対応表を文書化

### テスト結果

- vm-executor.test.ts: 39テスト全て成功
- 新命令セットでの基本動作確認完了

### 次の作業

vm-decoder.test.ts の新命令セット対応が必要
