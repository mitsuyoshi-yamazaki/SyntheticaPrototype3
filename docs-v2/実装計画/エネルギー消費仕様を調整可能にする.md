## 概要

ゲームバランスと自己複製の実現性に関わる、各種エネルギー消費量の仕様を簡単に切り替えられるようにする

## 目的

- エネルギー消費量やその他のパラメータを簡単に切り替えられるようにすることで、異なる仕様下で自己複製エージェントの振る舞いを観察できるようにする
- 自己複製が現実的に可能なバランスを探索可能にする

## 手法

1. 調整可能にするパラメータの洗い出し
2. それらのパラメータを1ファイルにまとめて、参照する際は全てそのファイルから読み出されるようにする
3. そのファイルを切り替えられるようにする
   - 実装時に切り替えられるようにするのが理想（その場合、切り替えたらシミュレータの内容は全てリセットで良い）だが、ソースコード上で指定する方式でも良い

## 調整可能にするパラメータ

### 1. ユニット構成エネルギー

#### HULL

- `hullEnergyPerCapacity`: 容量1あたりの構成エネルギー（デフォルト: 2E）

#### ASSEMBLER

- `assemblerBaseEnergy`: 基本構成エネルギー（デフォルト: 8000E）
- `assemblerEnergyPerPower`: assemble_power 1あたりの追加エネルギー（デフォルト: 2000E）
  - 自己複製考慮値: 1000E

#### COMPUTER

- `computerBaseEnergy`: 基本構成エネルギー（デフォルト: 500E）
- `computerFrequencyEnergyMultiplier`: 周波数に基づくエネルギー係数（デフォルト: 100E）
- `computerFrequencyDivisor`: 周波数の除数（デフォルト: 5）
- `computerMemoryEnergyPerByte`: メモリ1バイトあたりのエネルギー（デフォルト: 50E）

### 2. ユニット生産エネルギー（生産コスト係数）

- `hullProductionRatio`: HULL生産時の追加コスト係数（デフォルト: 0.05）
- `assemblerProductionRatio`: ASSEMBLER生産時の追加コスト係数（デフォルト: 0.5）
- `computerProductionRatio`: COMPUTER生産時の追加コスト係数（デフォルト: 0.1）

### 3. 生産開始時コスト

- `productionStartCostRatio`: 生産開始時に必要な初期エネルギーの係数（デフォルト: 0.05）

### 4. COMPUTER動作時の消費エネルギー

- `computerInstructionCost1Byte`: 1バイト命令の実行コスト（デフォルト: 1E）
- `computerInstructionCost3Byte`: 3バイト命令の実行コスト（デフォルト: 3E）
- `computerInstructionCost4Byte`: 4バイト命令の実行コスト（デフォルト: 4E）
- `computerInstructionCost5Byte`: 5バイト命令の実行コスト（デフォルト: 5E）
- `computerAbsoluteAddressCost`: 絶対アドレス命令の追加コスト（デフォルト: +2E）
- `computerUnitOperationCost`: ユニット操作命令の追加コスト（デフォルト: +10E）

### 5. エネルギー収集・崩壊

- `energyDecayRate`: エネルギーオブジェクトの自然崩壊割合（デフォルト: 0.001/tick）
- `energySourceMinOutput`: エネルギーソースの最小出力（デフォルト: 10E/tick）
- `energySourceMaxOutput`: エネルギーソースの最大出力（デフォルト: 100E/tick）
- `energyCollectionRadius`: HULLのエネルギー収集半径（デフォルト: HULL半径の2倍）

### 6. 熱システム

- `energyToHeatConversionRatio`: 消費エネルギーが熱に変わる割合（デフォルト: 1.0）
- `heatDiffusionRate`: 熱拡散率（デフォルト: 0.1）
- `heatRadiationRate`: 放熱率（デフォルト: 0.01/tick）
- `heatDamageThreshold`: 熱ダメージが発生する温度（デフォルト: 100度）
- `heatDamageMultiplier`: 熱ダメージ係数（デフォルト: 1.0）
- `heatDamageMultiplierDamaged`: 損傷ユニットへの熱ダメージ倍率（デフォルト: 2.0）
- `heatDamageMultiplierProducing`: 生産中ユニットへの熱ダメージ倍率（デフォルト: 3.0）

### 7. 修復コスト

- `repairCostMultiplier`: 修復時の追加コスト係数（デフォルト: 1.1）

### 8. ユニット結合・分離

- `hullMergeEnergyCost`: HULLマージ時のエネルギーコスト（デフォルト: 未定義）
- `unitDetachEnergyCost`: ユニット分離時のエネルギーコスト（デフォルト: 0E）

### 9. 物理・移動

- `movementEnergyCostPerMass`: 質量あたりの移動エネルギーコスト（デフォルト: 未定義）
- `collisionEnergyLoss`: 衝突時のエネルギー損失（デフォルト: 未定義）

## 実装方針

### ファイル構成

```typescript
// src/config/energy-parameters.ts
export interface EnergyParameters {
  // 上記の全パラメータ
}

export const DEFAULT_PARAMETERS: EnergyParameters = {
  // デフォルト値
}

export const BALANCED_PARAMETERS: EnergyParameters = {
  // 自己複製が現実的なバランス調整版
}

export const EXPERIMENTAL_PARAMETERS: EnergyParameters = {
  // 実験用パラメータ
}
```

### 切り替え方法

1. **実行時切り替え（推奨）**
   - UIにパラメータプリセット選択機能を追加
   - 選択時にワールドをリセット

2. **ビルド時切り替え（簡易実装）**
   - 環境変数でプリセットを指定
   - `ENERGY_PRESET=balanced yarn dev`

## テスト項目

1. **最小自己複製エージェント**
   - 各プリセットで自己複製が可能か確認
   - 必要な最小HULL容量を測定
   - 複製完了時間を測定

2. **エネルギー収支**
   - エネルギーソース1個での持続可能性
   - 熱による影響の評価

3. **パフォーマンス**
   - 1000体のエージェントでの動作確認

## 備考

- 未定義（TBD）のパラメータは、実装時に適切なデフォルト値を設定する
- パラメータ変更による影響を可視化するデバッグ機能も検討する
