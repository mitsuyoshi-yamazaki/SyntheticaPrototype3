## このファイルについて

- 本ファイルはアプリケーションの要件と仕様について記載している

## Claudeへの指示

- アプリケーションの要件と仕様を更新した際は本ファイルの内容も追従させること

## 要件

- このアプリケーションは、MMOゲームのプロトタイプである
- ゲーム
  - このゲームは、プレイヤーが作成したエージェントを環境中に放って自律行動するのを観察するMMOゲームである
    - このゲームでは、地球上に存在するものも存在しないものも含めて、任意の生態を持つエージェントを作成・繁殖できる場を提供することを目的とする
  - エージェントは全て自律的に動作し、環境中の資源を回収・代謝して自己を拡張・修復・複製する
  - エージェントの身体は資源回収、移動、アセンブリ、情報処理など複数の種類のユニットを組み合わせて成り立つ
  - プレイヤーはこのエージェントの身体部分を定義するとともに、頭脳ユニットで実行するソフトウェアを作成することでエージェントを作成する
  - ゲームの要件と仕様の詳細は各 `spec-v3/` （v3は仕様書バージョン, v3が最新）以下の `game-world-requirements.md` を参照
- アーキテクチャ
  - このゲームはサーバー上で常時動作し続ける
  - プレイヤーはクライアントアプリケーションを通じて以下のふたつの行動をとることができる
    - 1. サーバー上で動作する世界に自作のエージェントを放つ
    - 2. 現在の世界の状況を観察する
- プロトタイプ要件
  - このプロトタイプはゲーム部分の仕様をブラッシュアップすることを目的とする
  - 本プロトタイプで作成する部分
    - 本プロトタイプではサーバーを作成せず、webブラウザ上で動作する静的HTMLファイルの形式でゲームを作成する
    - プレイヤーがエージェントを自作するための機能は搭載せず、全てのエージェントはソースコードに埋め込んだものが読み込まれる

## 経緯

_TODO: ゲームのコンセプトとしてまとめる_

- 「多彩な生態の自律エージェントを観察、操作して楽しみたい」という要望を叶えられるメディアは現状ない
- 存在するメディアと課題
  - 地球生命の飼育
    - 種によっては飼育自体の難易度が非常に高い
    - 操作することの難易度が非常に高い（個人で行えるのは家畜化された小生物を交配させることくらい）
    - 例：蚕, 蟻コロニー, プラナリア等の継代飼育, またカギムシ類などの希少な生態をもつ生物の飼育
  - 人工生命シミュレータ
    - 行いたい操作を直接組み込むことはできず、行われた変更が創発してどのような振る舞いが起きるか観察し、変更を修正する、という試行錯誤が必要
    - シミュレータ系自体の制約により、行いたい操作が行えないことが多い
    - シミュレータ系の開発目的から大きく外れたふるまいは系の仕組みとしてcapableでないことが多く、全く予想されない振る舞いは発生しにくい（★）
    - 例：Tierra, alien project
  - 人工化学シミュレータ
    - 例：SwarmChemistry
  - 進化ゲーム
    - 進化により探索されるパラメータ空間が非常に狭く、しばしば全て予測可能なサイズである
    - 人工生命シミュレータの ★ と同じ課題がある
  - プログラミングゲーム
    - 通常は競争がコンセプトに入っており、利用できる各種資源量に上限が設けられている。そのためエージェントが自己を拡張/複製する過程に（系としてではなく、ゲームバランス的な）上限が設けられてしまう
    - エージェントの生態の差異は、それを直接意図して差が生まれるのではなく、（ゲーム内競争に勝利することなどの）目的を達成する過程で副次的に生まれるものである
    - 例: Screeps
  - 創作物（主にSF, ファンタジー）
    - 非常に挑戦的で興味深い内容を構築できる反面、完全に一貫した仕様を構築することは困難で、実現性はとても低い
    - 例: 「直交」三部作, 「竜が最後に帰る場所」, 「怪獣保護区」, 「七十二文字」
- メディア固有の課題もあるが、大きく分類すると本質的な課題は以下
  - 進化の探索空間の狭さ
  - 操作の容易性
    - 現実の化学のように、系としてcapableでも人間が技術的あるいは単に思考能力が追いつかないために操作できないものもある
    - 探索空間が広すぎることにより操作が複雑になるトレードオフもある
    - また、探索空間自体は広いが、試行回数の問題で全体を探索できないという問題も発生する
- 探索空間の狭さはその系の設計の問題であり、操作の容易性はその系に対してどのように操作を行うかというアプリケーションの問題である
- これらの課題を本アプリケーションでは以下のように解決する
  - 系（探索空間）は、エントロピーライクな法則をもち※、かつ一貫した（例外の少ない）プリミティブな物理法則をもつシンプルな任意の仕様とする
    - ※ 根本的な淘汰圧を提供する
    - 系の設計時に仕様を詰め切らないことで、ある程度アプリケーション側の問題を系の仕様で解決できるように、またアップデートにより（今までない仕様を追加するのではなく）既存の仕様を詳細化することでできることを増やしていける余地を設けられるようにする
  - プリミティブな物理法則に対して生物的な自律行動を実装するための、創発を回避して直接振る舞いを実装する手段（ユニット仕様）を提供することで、探索範囲を広げる
    - これらのユニットは物理法則とは抽象度の度合いが大きく異なり、明確な目的を持って稼動するオブジェクトである
    - ユニットの仕様は、将来的に「物理法則のみからユニットを製造できるようになる」という点を満たすものとして策定する
  - また、アプリケーションのジャンルをマルチプレイヤーMMOとすることで競争性を導入し、それにより 1. 最適解の多様化, 2. 探索の加速 を行う
  - 総じて言えば、探索空間の広さはプリミティブな物理法則により担保し、操作の容易性は物理法則より抽象度の高い"準生物"ユニットを用意することで解決する、また競争を取り入れることで探索空間の探索を加速する、というコンセプト
  - ここまでの要件では実装方法までは確定しないため様々な実現手段が考えられるが、ここでは参考にできる対象の多い"工場系"ゲームの仕様を採用する（世界には資源が配置されており、それを回収・精錬・合成して製造を行う、生成物は分解されると資源に戻る）
    - 表現としては微小生物の他に、自己複製宇宙船や自律ロボットなども考えられる
- MEMO: 操作の容易性について
  - 創発を可能にする系は「行い」ベースの操作であるのに対して、操作の容易な系は「目的」ベースの操作である
  - 本システムでは「目的」ベースでプログラミング/エージェントの構築ができるが、内部的には「行い」に近い（例えば、目的に対する操作は「失敗」しうるが、そういうものはない）状態で実装する

## アプリケーション仕様

- ブラウザ上で動作する
  - 静的HTMLファイルをブラウザが読み込み動作する
  - バックエンドアプリケーションは不要
  - データの永続化も不要

## 利用技術と仕様

- 以下の技術を利用する
  - 言語はTypeScript
  - lintはESLint
  - フォーマッタはPrettier
  - パッケージマネージャはyarn
  - テストはjest
  - フレームワークはNextJs
  - ホスティングにはVercel
  - 描画系はp5.js
  - CSSはTailwind
- CI
  - GitHub Actionsを利用し、Pull Requestにpushがあった際にテストが実行されるようにする
    - CIによるデプロイは現状では設定しない
