## このファイルについて

- 本ファイルはゲームの要件と仕様について記載している
- **本ファイルは、ゲーム本体の仕様と実装を考える際の材料とするためのプロトタイプ仕様である**
- 本ファイルに記載の用語については、日本語の後に[]でソフトウェア上で表記する名前を記載する

## 仕様バージョン

- **現在のバージョン**: 4.0.0
- **バージョニング方式**: Semantic Versioning 2.0.0
  - MAJOR: 後方互換性のない変更
  - MINOR: 後方互換性のある機能追加
  - PATCH: 後方互換性のあるバグ修正
- **変更履歴**:
  - 4.0.0 (2025-10-01): バージョン作成

### 実現可能な生態

- 自己複製手法
  - プログラム的に娘個体を定義する方法
  - メモリ上に格納したスペックを元に娘個体を生成する方法
    - スペックで指定できる範囲は、ユニットの有無とユニットの性能のみ
  - 自身のスペックをスキャンしてコピーする方法
- 突然変異手法
  - 乱数
    - HULLの格納エネルギーの下位桁を読むなど、環境との相互作用により擬似的な乱数値を得る
  - COMPUTERのメモリを変異させることで、COMPUTERのプログラムおよび（その機能があれば）複製する娘個体のスペックを変異させられる
- 進化手法
  - 自己複製時の突然変異によるダーウィニズム進化
  - 自己複製時に自身の経験を娘個体へ書き込むラマルキズム進化
- 生殖手法
  - 単為生殖、クローン
- 共生
  - ASSEMBLERで自身のHULL内に別個体を生成すれば共生は実現できるが、生態上の利点はないと思われる

### 実現不能な生態

- 生殖手法
  - 有性生殖
    - 遺伝情報の媒体は唯一、COMPUTERのメモリを利用可能だが、読み取りのために受け取る方法がない
- 生命形態
  - 多細胞化
    - 複数のHULLを結合することはできるが、単細胞の形態に対する利点を設けるのはできないと思われる
- 捕食
  - 他個体の発見、ダメージを与えることができないため
- 寄生
  - 他個体の発見、接続ができないため

## Claudeへの指示

- ゲームの要件と仕様を更新した際は本ファイルの内容も追従させること

## ゲーム要件

- このゲームは、プレイヤーが作成したエージェントを環境中に放って自律行動するのを観察するMMOゲームである
  - このゲームの目的は、オープンエンドな進化を、①十分に一貫した自由度の高いシミュレーション系のうえで、②人間に競争させることでオープンエンド性を付与する ことで実現するものである（※ 人間が競争する際に発揮する創造性はオープンエンドであるという仮定のもと進める）
- エージェントは全て自律的に動作し、環境中の資源を回収・代謝して自己を拡張・修復・複製する
- エージェントの身体は資源回収、移動、アセンブリ、情報処理など複数の種類のユニットを組み合わせて成り立つ
- プレイヤーはこのエージェントの身体部分を定義するとともに、頭脳ユニットで実行するソフトウェアを作成することでエージェントを作成する
- このゲームの独自性は、地球上に存在するものも存在しないものも含めて、任意の生態を持つエージェントを作成・繁殖できる場を提供することを目的とする

## ゲーム仕様

### 世界[World]

- 世界は上下左右がループした二次元トーラス形状をとる
- ゲームの空間（正確には平面であるが、空間と呼称する）は正方形のセル[Cell]に分割されており、空間に作用する現象（現状では熱のみ）は個々のセルに対して作用する
  - 一方でゲームオブジェクトの移動はセルとは無関係に、連続値の座標を取る
- ゲームの時間は離散的である。各tickにゲームオブジェクト物理演算とユニットの動作処理が行われ、その結果が次tickに反映される

### "実際のゲーム世界"

_"実際のゲーム世界"のセクションはアプリケーションの仕様には影響しない、仕様策定の際のフレーバー背景である_

- このゲームは、ゲーム内の物理法則として、質量の保存則やエントロピーの法則をもつ
- このゲームの仕様としてそれらの法則に例外があるように見える（エネルギーソースからエネルギーが無限に湧き出す、熱が時間経過で減っていく、等）のは、アプリケーション上に表現されるこのゲームの空間は、"実際のゲーム世界"の"高さ"方向の一断面に過ぎないためである
  - このゲームの空間は、"実際のゲーム世界"の中での局所的にエントロピーが減少する一部分を切り取ったものである
  - その解釈に基づくと、エネルギーソースは"実際のゲーム世界"からのエネルギー供給、放熱は"実際のゲーム世界"の高さ方向へ熱が拡散していく現象である、と解釈される
  - これは現実世界における以下の現象との対応で理解できる
    - このゲームの空間：地球（太陽から供給されるエネルギーによる局所的なエントロピーの減少）
    - エネルギーソース：太陽
    - 放熱：宇宙空間への放熱

### ゲームオブジェクト[GameObject]

- ゲーム世界上に存在する物体のことをゲームオブジェクトと呼称する
- ゲームオブジェクトは以下のプロパティをもつ
  - 位置[Position]
    - 位置は（離散的なグリッド上に置かれるのではなく）連続的数値で表される
  - 大きさ、形状（v3では全て円形）
  - 速度[Velocity]
    - 速度は前tickにそのゲームオブジェクトに加わった加速度により増減する
  - 加速度[Acceleration]
  - 重量[Weight]
    - 重量はゲームオブジェクトにかかった力がどれだけの加速度を生むかに影響する
- 仕様
  - 衝突[Collision]
    - 複数のゲームオブジェクトが同時に同じ空間の一点に存在することは禁止したいが、計算処理を容易にするため、完全に禁止はせずに以下の仕様で実装する
      - 重なった複数の物体は共通重心から離れる方向へ力（反発力[Separation Force]）を受ける（ことにより、物体の重なりを時間経過で解消する）
      - 詳細仕槕：`physics-system-specification.md`参照
  - 隣接[Adjacent]
    - ふたつのオブジェクトが"隣接"している状態とは以下のどれかの状態である
      - 双方がユニットであり、接続している状態
      - ふたつのオブジェクトが"隣接距離"以下の間隔で隣り合っている状態
        - 両方がHULLの中にいる場合は常に隣接状態
        - HULLとそのHULLの内容物は常に隣接状態

### tickの処理

- 処理順：
  1. **ユニットアクションフェーズ**
     1-1. 予約されたアクションのためのエネルギーを確保する（確保順序：`energy-action-order.md`参照）
     1-2. 予約されたアクションを実行する（実行順序：`energy-action-order.md`参照）- エネルギー確保に成功したアクション：通常処理を実行 - エネルギー確保に失敗したアクション：アクション種別ごとに定義された失敗時処理を実行
     1-3. COMPUTERが動作可能なエネルギーがある場合は、エネルギーの消費とそれによる熱発生のみ先行して処理する
  2. **物理演算フェーズ**
     2-1. 加速度・速度計算（方向性力場の影響を含む、`directional-force-field-specification.md`参照）
     2-2. 位置更新
     2-3. 衝突検出・反発力計算（`physics-system-specification.md`参照）
  3. **環境処理フェーズ**
     3-1. エネルギーソースからエネルギー生成（`energy-source-specification.md`参照）
     3-2. エネルギーの自然崩壊処理（`energy-decay-specification.md`参照）
  4. **熱処理フェーズ**
     4-1. 熱拡散計算（`heat-diffusion-system.md`参照）
     4-2. 熱放熱計算（`heat-diffusion-system.md`参照）
     4-3. 環境ダメージ判定・適用
  5. **Synthetica Script実行フェーズ**
     5-1. COMPUTER動作（Synthetica Script実行）
     5-2. 次tick用アクション予約受付

- アクション予約制：
  - 全てのユニットアクションは「次のtickで行うアクションを予約する」形で指示される
  - COMPUTERによるSynthetica Script実行時に各ユニットへのアクション予約が行われる
  - Synthetica Scriptの実行はtickの処理が全て完了した状態で行われる

- アクション競合時の処理：
  - 複数ASSEMBLERが同じ場所への生成を予約した場合：生成対象ユニットの占める容積が大きい順に実行し、最初のもののみ成功
  - 複数DISASSEMBLERが同じターゲットを予約した場合：合計されたdisassemble powerでdisassembleを実行

- HULLマージの双方向同意：
  - 各HULLは「マージ対象」プロパティを持つ
  - 双方が互いを指定した場合にのみマージ実行
  - 片方のみの予約の場合は待機状態を維持

- 予約時と実行時の状況変化：
  - 隣接状態は予約時（tick末）と実行時（次tick開始）で変化しない

- エネルギー消費の統一フレームワーク：
  - エネルギー確保の失敗によるアクション失敗と、エネルギー確保後のアクション処理失敗は別処理
  - エネルギー確保順序とアクション実行順序は別々に定義される（`energy-action-order.md`参照）
  - エネルギー確保失敗時の挙動はアクション種別ごとに定義される

- （仕様策定時の方針）処理順の計算を簡便にするため、また現実世界のアクションは全て逐次的に起きることを参考に、何かのアクションが失敗する場合は、「そのアクションが行われなかったことにする」のではなく、「そのアクションを行なったが失敗した」、という状況になるようにする
  - 例：assembleに必要なエネルギーは確保できたが、assemble対象を設置できないとなった場合、「エネルギーが消費されなかったことにする」のではなく、「エネルギーを消費して設置を試みたが、結果として設置はされなかった（エネルギーは消費される）」とする

### 熱[Heat]

- 空間のセルは熱の値をもち、熱はゲームオブジェクトに影響を与える
- 挙動
  - 熱の値はエネルギーの消費等、世界とゲームオブジェクトのさまざまな活動によりセルに加算される
    - これはこの世界におけるエントロピーを表現している
  - 熱の値は隣接セルの間で均衡するように移動する。この計算時は熱の総量は増減しない（この計算後、後述の放熱の計算により熱の総量は減少する）
  - セルの熱の値は時間経過で減ってゆく
    - これは放熱を表現している
  - 熱拡散・放熱の詳細：`heat-diffusion-system.md`参照
- 後述の資源やユニットはそれ自体は熱の値を持たず、配置されているセルの熱の値により熱の影響を受ける
  - 資源やユニットは大きさをもつので複数のセルにまたがる位置に存在することがあるが、受ける熱の影響は、ユニットの座標が含まれるセルの熱の値である
    - この仕様は基本的にはゲーム世界の法則の一貫性を崩すが、プロトタイプであるので実装の簡便さと法則の一貫性の間をとってこの仕様とする
- 熱ダメージ仕様：
  - ダメージ閾値：セルの熱が100度を超えると熱ダメージが発生
  - ダメージ量：`ceil(熱 - 100)E` per tick
  - ユニット状態による影響：
    - 通常状態：上記ダメージを受ける
    - 部分損傷状態（構成エネルギーの50%以下）：ダメージ2倍
    - 生産中ユニット：ダメージ3倍
  - HULL内部のユニットも熱ダメージを受ける（HULLは熱を遮断しない）

#### エネルギー[Energy]

- エネルギーは、現実世界の資源やエネルギーに相当するゲームオブジェクトである。ゲーム世界においては、構造材料及びエネルギーの両方の性質をもつ
- エネルギーはエネルギーソースから、ソースごとに定められたエネルギー算出量に応じて、毎tick生成される（世界に新たに追加される）
  - エネルギーソースの配置：
    - 初期配置：ゲーム開始時にワールド全体に均等に配置（配置密度は設定可能）
    - 各エネルギーソースは固定位置を持つ
    - エネルギーソースは破壊不可能
  - エネルギーの出現：
    - エネルギーソースの座標に直接出現
    - 既にその位置にゲームオブジェクトが存在する場合は、最も近い空き位置に出現
    - 複数のエージェントが同じエネルギーを回収しようとした場合、より近い位置にいるエージェントが優先される
  - 詳細仕様：`energy-source-specification.md`参照
- 資源の分解や合成、エージェントの移動やCOMPUTERの計算処理など、全ての活動はエネルギーを消費する。消費されたエネルギーは完全に消滅するが、消費されたエネルギー量に比例した熱をその場所に加える
- エネルギーはゲームオブジェクトである。つまり、ゲーム世界上に物体として存在する
- エネルギーの自然崩壊：
  - 未使用のエネルギーオブジェクトは時間経過により自然に崩壊し、熱に変換される
  - 崩壊量 = `ceil(sqrt(エネルギー量) / 10)` E/tick
  - 崩壊により発生した熱は、エネルギーオブジェクトが存在するセルに加算される
  - この仕様により、エネルギーが無限に蓄積することを防ぎ、エントロピー増大の法則を表現する
  - 詳細仕様：`energy-decay-specification.md`参照
- 本仕様書を含め、エネルギーの量を記載する際に数値に `E` をつけて `5E`, `123E` （それぞれエネルギーが5単位、123単位）と表記する
- エネルギーオブジェクトの物理的挙動：`energy-object-physics.md`参照

### エージェント

- 「エージェント」とは、相互に結合したユニットの集まりを、人間のために便宜上そう呼んでいるだけであり、ゲームの実装上そのような単位の実装が存在するわけではない
  - ゲーム世界上では、それぞれのユニットが自律して動作し、周囲のユニットや環境と相互作用を行っているだけである

### ユニット[AgentUnit]

- ユニットはゲームオブジェクトである
- 仕様：
  - ユニット生成時に固定される性質と、生成後に再設定可能な性質がある
  - ユニット生成[Assemble]
    - 全てのユニットはASSEMBLERにより、そのユニットを構成するのに必要なエネルギーを消費して生成される
    - ユニット構築に必要なエネルギーの量は、ユニットの種類と仕様によって異なる
      - この仕様は各ユニットの「生産仕様」の項に定義される
        - ユニット生成に要するエネルギーは大部分がそのユニットを構成するのに使われる（ユニット構成エネルギー[Build Energy]）が、その他はユニット生成活動によって消費される（ユニット生産エネルギー[Assemble Energy]）。つまり、ユニットを分解して得られるエネルギーは、そのユニットを生成するのに必要な総エネルギー量（ユニットコスト[Unit Cost]）より常に少なくなる
  - ユニット分解[Disassemble]
    - ユニットはDISASSEMBLERに分解される、または環境ダメージを受けることにより構成エネルギーを失う（= ダメージを負う）
      - 軽微なダメージはASSEMBLERにより、失ったエネルギーを補充することで修復が可能である
      - 構成エネルギーが0になったユニットは（エネルギーに変化することで）消滅する
    - あるユニットが構成エネルギーを失うことにより発生する変化はユニットの「分解仕様」の項に定義される
  - ユニットはゲームオブジェクトに直接作用しない、ソフトウェアの実行に関わる回路[Circuit]としての性質をもつ（ユニットの「回路仕様」に記載）
    - v3では移動ユニット（MOVER）は存在せず、代わりに方向性力場による移動を実現（`directional-force-field-specification.md`参照）
  - ユニットはHULLの外側または内側に固定[Attach]することができる。HULLも例外ではない
  - ユニットの状態：
    - **HULL固定状態**: HULLに物理的に固定される
    - **HULL格納状態**: HULLの内部空間に格納される
    - **自由状態**: 座標を持ってゲーム世界を漂う
  - ユニット結合構造の表現：
    - HULL中心の管理方式を採用
    - 各HULLが固定ユニット(attachedUnits)と格納オブジェクト(containedObjects)を管理
  - 隣接・ダメージルール：
    - HULL固定ユニットは、そのHULLの隣接状態を継承
    - HULL固定ユニットはHULL外のDISASSEMBLERからのダメージを受けない（HULLが代理受傷）
    - 熱ダメージは固定/格納状態によらず全ユニットが受ける
  - 基本的な構想として、ユニットが何かの行動を起こそうとして失敗する場合、ソフトウェア的なエラーを返すのではなく、実行はするが意図した結果が得られない、という現象として実現する
- 回路仕様：
  - 回路的に接続しているユニットへはソフトウェア上で情報アクセスおよび指示ができる
  - v3では同一HULLに固定された全ユニットが相互にアクセス可能（`circuit-connection-specification.md`参照）
  - 接続数の上限なし
- COMPUTERから各ユニットにアクセスし、ユニット状態の読み取りやユニット機能の実行を行うために、各ユニットには操作用のメモリ領域が用意されている（領域の最大容量（アドレスbit幅）は8bit）
  - この操作メモリ領域のどこの番地に何の機能がマッピングされているかは、各ユニットの項の「操作メモリ領域仕様」に記載されている
  - 各操作メモリ領域は16bitで、それぞれの領域はReadonly（ユニット状態の確認用）, ReadWrite（ユニット状態の指定 + 確認: [RW]記載）のどれかの状態を持っている
  - COMPUTERからアクセスする際は以下の操作となる
    - 読み取り：メモリアドレスを指定してメモリ値を読み取る
    - 書き込み：メモリアドレスを指定してメモリへ値を書き込む
  - Readonlyの領域へ書き込み操作を行なっても何も起きない
  - Writeonlyという状態はない（読み取れないメモリ領域はない）
  - 各ユニットの操作メモリ領域仕様には以下の記載によってその領域の性質が記載されている
    - メモリアドレス
    - Readonly/ReadWrite （それぞれ [R] / [RW] と記載）
    - メモリ値の型（bool, int, uint）
- ユニットには以下の種別がある
  - HULL
  - ASSEMBLER
  - COMPUTER

#### HULL

- 概要：
  - ゲーム世界の一角を区切ることで、エージェントの身体を形作る。エージェントを細胞に例えるとHULLは細胞膜である
- 仕様：
  - HULLは容量をもち、他のユニットや資源を格納できる
    - HULLの内部にゲームオブジェクトが配置される状況は以下の3つがある
      - HULLが外部から取り込む
        - 容量の上限を超える場合は単に取り込まない
      - HULLの内側に存在するユニットが、ユニットや資源を排出する
        - 容量の上限を超える場合はHULLの外側へ排出/設置される
      - HULLの内側に存在するユニットが、ユニットや資源を設置する
        - 容量の上限を超える場合は設置に失敗する。その結果何が起きるかは、設置を行うアクションによる
  - HULLの中身は広さのない空間（内容物全てが"隣接"しており、内容物のHULLに対する相対速度は常に0の状態）である
    - この性質により、HULLの内部に配置されたASSEMBLERやDISASSEMBLERはHULLとHULLの内部に格納されたユニット全てに対して操作が可能である
    - ゲーム的な観点から、見た目上は広さがあり、それぞれの内容物が重ならずに存在している見た目（細胞の模式図のような）をとる
  - ~~HULLは入れ子にできる~~
    - 将来的には入れ子にできるようにするが、v3においてはできない
    - HULLを別のHULLへ固定する場合は、常に外側へ接続する状態になる。また、HULL(a)内部のASSEMBLERがHULL(a)に固定されないHULL(b)を生成する場合も、bはaの外部へ生成されるものとする
  - HULLには外側と内側がある
  - 回収/放出
    - "隣接"したエネルギーをHULL内に回収できる。また、回収を停止し、HULL内のエネルギーを外部へ放出することもできる
      - 部分回収：HULLの容量が不足する場合、可能な分だけ回収し、残りは元の位置に残る（`energy-object-physics.md`参照）
      - エネルギー以外のゲームオブジェクトは能動的に回収/放出はできない。HULL内に存在するユニットやユニット断片が放出されるのは、HULLが完全に破壊（分解された後のdestroyed HULLが破壊された状態）された際である
  - 拡張
    - HULLは別のHULLとマージ[merge]することにより容量の拡張が可能である
    - マージにはエネルギーを消費する
    - 拡張を行うには、自身のHULLとマージ対象のHULLが互いに回路で接続されており、かつ隣接している状態で、互いに互いをmerge対象として指定した際にマージされる
    - マージ実行順序：
      - マージ前のそれぞれのHULLでの物質の出入りを全て解決
      - その後にマージを実行
    - マージ後の統合：
      - ID：古い方のHULLのIDが引き継がれる（IDが小さい方を保持）
      - 容量：マージ前の両HULLの容量の合計値
      - 固定ユニット：両HULLの固定ユニット(attachedUnits)がマージ後HULLに移行（固定位置は不定）
      - 格納オブジェクト：両HULLの格納オブジェクト(containedObjects)がマージ後HULLに移行
      - 回路接続：両HULLの回路が統合される
  - 分離
    - HULLは他のHULLに固定可能である
    - HULL以外のユニットは破壊される以外の方法では固定を解除できない
    - HULLのみは自身の固定を任意で解除できる（分離機構）
    - 分離機構は自己複製時に娘個体を生成後、自身から切り離す際に利用される
- 回路仕様：
  - HULLに接続しているユニットを回路的に接続する
  - v3ではaccessibility機能を廃止（他者のHULLへのアクセス手段が存在しないため）
  - 同一HULLに固定された全ユニットが相互にフルアクセス可能
- 操作メモリ領域仕様：
  - 0x00: [R] uint HULL容量（スペック）
  - 0x01: [R] uint 現在の格納量
  - 0x02: [R] uint 現在のk格納量
  - 0x03: [R] uint エネルギー格納量
  - 0x04: [R] uint kエネルギー格納量
  - 0x05: [RW] bool エネルギー回収状態
  - 0x06: [RW] uint マージ対象指定
  - 0x07: [RW] uint 分離対象ユニット種別
  - 0x08: [RW] uint 分離対象ユニットindex
  - 0x09: [RW] bool 分離実行フラグ。　Trueを書き込むと実行。実行後Falseがセットされる
- 生成仕様
  - 構成エネルギー = `容量 × 2E`
  - 生産エネルギー = `ceil(構成エネルギー × 0.05)`
- 分解仕様：
  - HULLを構成する `ceil(構成エネルギー量 / 2)` 以上のエネルギーが剥ぎ取られると、
    - 環境ダメージによりダメージを受ける条件が広くなる（今まではダメージを受けなかった状況で環境ダメージを受けるようになる）

#### ASSEMBLER

- 概要：
  - 指定したユニットの生成もしくはユニットの修復を行う
- 仕様：
  - ユニットの生産処理
    1. 生産するユニットが設置場所に出現する。この生産中ユニット[Producing Unit]は、ユニットと同じ容積の空間を占有する。ユニットの機能は何も機能しない
       - 生産中ユニットは通常より広い条件で、大きな環境ダメージを受ける。そのため、そのまま継続的にassembleされないと分解する
       - 生産中ユニット生成に必要なエネルギー = `ceil(完成ユニットの構成エネルギー × 0.05)`
       - HULLの内部に設置する場合で、HULL容積が足りない場合は、設置されずエネルギーが熱に変わるのみ
    2. 生産中ユニットに対してassembleを続ける
       - assembleをされると生産中ユニットに構成エネルギーが蓄積していく
       - assemble時に必要なエネルギーはASSEMBLERに隣接したエネルギーを消費する
         - 必要なエネルギーが得られない場合は何も起きない
    3. assembleが完了
       - 生産中ユニットがmaxのユニット構成エネルギーに達するとassembleが完了し、全機能が動作するユニットに変化する
  - ASSEMBLERはassembleする速度assemble powerパラメータを持つ
    - assemble powerはtickあたりの生産/修理の進捗に影響する。assemble powerが大きい方が早い
  - ユニットの修復
    - 指定のユニットの修理を行う。修理とは、そのユニットのダメージを、エネルギーを使って修復することである
    - n 単位のダメージを修復するには n 単位のエネルギーの他に、 `(n * ユニット生産エネルギー / ユニット構成エネルギー) * 1.1` のエネルギーが修理を行うのに必要である
  - 生成物の設置
    - ユニットを生成する場合はその生産物をどこへ設置するか（あるいは設置せず空間を漂うに任せるか）を選ぶことができる
      - ASSEMBLERがHULLに固定されていない場合、生産物の設置先がないため設置はできない（ASSEMBLERの隣に出現する）
      - ASSEMBLERがHULLに固定されている場合、そのHULL（⭐︎）の内側・外側へ設置可能
        - また、⭐︎に固定されたHULL、⭐︎に格納されているHULL、⭐︎を格納しているHULL、そしてそれらに再帰的に固定/格納/被格納しているHULLの内側・外側へ設置可能
- 回路仕様：
  - なし
- 操作メモリ領域仕様：
  - 0x00: [R] uint assemble_power（スペック）
  - 0x01: [RW] uint 生産ユニット種別
  - 0x02: [RW] uint 生産ユニット接続HULL index
  - 0x03: [RW] uint 生産パラメータ1
  - 0x04: [RW] uint 生産パラメータ2
  - 0x05: [RW] uint 生産パラメータ3（予約）
  - 0x06: [RW] uint 生産パラメータ4（予約）
  - 0x07: [RW] uint 生産パラメータ5（予約）
  - 0x08: [RW] uint 生産パラメータ6（予約）
  - 0x09: [RW] bool 生産状態（Trueをセットすると生産ユニット種別および生産パラメータの仕様を元に生産を開始する。Falseをセットすると生産を一時停止する。生産が完了するとFalseがセットされる）
  - 0x0A: [RW] uint 修理ユニット種別
  - 0x0B: [RW] uint 修理ユニットindex
  - 0x0C: [RW] bool 修理状態（Trueをセットすると修理ユニット種別および修理ユニットindexを元に修理を開始する。Falseをセットすると修理を停止する。修理が完了するとFalseがセットされる）
  - 0x0D: [R] uint 最後に生産したユニット種別
  - 0x0E: [R] uint 最後に生産したユニットindex
  - 0x0F: [RW] bool 最後に生産したユニット情報をリセット。Trueをセットすると最後に生産したユニット種別および最後に生産したユニットindexをリセットする。リセット実行後Falseがセットされる
  - 生産と修理は排他である。修理中に生産を開始すると修理は中断される。また、生産中に修理を開始すると生産は中断される。
- 生成仕様：
  - 構成エネルギー = `800E + (assemble_power × 200E)` （assemble_powerは1以上）
  - 生産エネルギー = `ceil(構成エネルギー × 0.2)`
  - 占める容積 = assemble_powerに比例
- 分解仕様：
  - ASSEMBLERを構成する `ceil(構成エネルギー量 / 10)` 以上のエネルギーが剥ぎ取られるとassembleが行えなくなる
  - ASSEMBLERを構成する `ceil(構成エネルギー量 / 2)` 以上のエネルギー（※）が剥ぎ取られると、環境ダメージによりダメージを受ける条件が広くなる（今まではダメージを受けなかった状況で環境ダメージを受けるようになる）

#### DISASSEMBLER（v3では廃止、v4で実装予定）

- 概要：
  - 指定のターゲットからエネルギーを剥ぎ取る
- 仕様：
  - 指定のターゲットからエネルギーを剥ぎ取る
  - 指定できるターゲット種別はユニットとユニット断片である
  - 実際にターゲットをdisassembleするにはターゲットと隣接している必要がある
    - 接続しているターゲットを指定するにはソフトウェア上でのそのターゲットの識別子により指定する
    - 隣接しているターゲットは直接指定できず、隣接した任意のゲームオブジェクトをdisassembleする、ということになる
  - disassembleを試みるには、disassemble対象を指定し、1以上のエネルギーを投入する必要がある
    - disassemble対象の構造的な強度が投入エネルギーより小さい場合にdisassembleに成功する
      - 強度が投入エネルギー以上である場合はdisassembleに失敗し、投入したエネルギーは消費され熱となる。また、投入エネルギーが強度を大きく上回った場合も、投入エネルギーは全量消費される
      - 同時に複数のDISASSEMBLERからdisassemble対象になった場合は、個々の投入エネルギーが強度を下回っていても、合計の投入エネルギーが強度を上回ればdisassembleされる
  - 剥ぎ取られたエネルギーはdisassemble対象に隣接する空間に出現する
- 回路仕様：
  - なし
- 操作メモリ領域仕様：
  - TBD: disassemble対象を指定できるようにするためにはCONNECTORが存在する方がシンプルである。初期仕様からDISASSEMBLERを外すことを検討する
- 生成仕様：
  - 構成エネルギー = `200E + (disassemble_power × 100E)`
  - 生産エネルギー = `ceil(構成エネルギー × 0.2)`
- 分解仕様：
  - DISASSEMBLERを構成する `ceil(構成エネルギー量 / 5)` 以上のエネルギーが剥ぎ取られると機能を停止する
  - DISASSEMBLERを構成する `ceil(構成エネルギー量 / 2)` 以上のエネルギー（※）が剥ぎ取られると、環境ダメージによりダメージを受ける条件が広くなる（今まではダメージを受けなかった状況で環境ダメージを受けるようになる）

#### COMPUTER

- 概要：
  - Synthetica Scriptで記述されたソフトウェアを実行し、回路的に接続しているユニットを制御する
- 仕様：
  - アセンブリ言語であるSynthetica Scriptを解釈し、実行する
  - COMPUTERはプログラムカウンタ、固定bit長のワーキングレジスタ、メモリの3要素から成る
    - つまり、プログラムとデータは分離していない（分離させたい場合は、データ領域にプログラムカウンタが侵入しないようなプログラムにする）
  - COMPUTERの生成時に指定できる性能は以下のふたつである
    - 動作周波数
      - tickあたり何命令を実行できるかを表す（例：10命令/tick）
        - 動作周波数がtickより遅い（例：1命令/3tick）設定も可能
    - メモリ容量
      - メモリの格納容量
  - ワーキングレジスタの内容は、回路で接続した他のユニットからも読み取ることができる
    - "有性生殖"はこの機能により可能となる
  - COMPUTERの動作（命令の実行）にはエネルギーを消費する
- 回路仕様：
  - なし
- 操作メモリ領域仕様：
  - この操作メモリ領域は、COMPUTERのプログラムを格納するメモリ領域とは別の領域であり、プログラムから操作メモリをアクセスするには、他ユニットの操作メモリへの操作と同様に UNIT*MEM* 系の命令を用いる
  - COMPUTERが自身に対する操作を行う際は、COMPUTERのindex 0番が常に自身のCOMPUTERを示すインデックスとして予約されているので、それを用いる
  - 0x00: [R] int 動作周波数（スペック）（正の整数: 命令実行数/tick、負の整数: -n は 1命令実行/n tick）
  - 0x01: [R] uint メモリ容量（スペック）
  - 0x02: [RW] bool メモリ領域の外部書き換え・読み取り許可状態（他COMPUTERからメモリ内容の読み取りおよび書き換えの許可状態。生成時はTrue。FalseからTrueに変更する操作は自身のみ行える）
  - 0x03: [RW] uint メモリ指定アドレス上位bit（メモリ領域の外部書き換え・読み取り許可状態であるとき、書き換え・読み取り対象アドレスを指定する）
  - 0x04: [RW] uint メモリ指定アドレス下位bit
  - 0x05: [RW] uint メモリ値（メモリ領域の外部書き換え・読み取り許可状態であるとき、メモリ指定アドレスで指定されたメモリの内容を表示する。書き換えればメモリの内容が書き変わる）
  - 0x06: [RW] bool メモリ書き込みフラグ
- 生成仕様：
  - 構成エネルギー = `500E + ceil((動作周波数 / 5)^2 × 100E) + (メモリ容量 × 50E)` 動作周波数は分数（ 1/n tick）を取りうる。メモリ容量は0も指定可能
  - 生産エネルギー = `ceil(構成エネルギー × 0.1)`
- 分解仕様：
  - COMPUTERを構成する `ceil(構成エネルギー量 / 20)` 以上のエネルギーが剥ぎ取られると動作を停止する
  - COMPUTERを構成する `ceil(構成エネルギー量 / 10)` 以上のエネルギーが剥ぎ取られると、プログラムカウンタ、ワーキングレジスタ、メモリの順に内容がゼロクリアされる

### Synthetica Script

- Synthetica Assembler

### 自己複製エージェント仕様

#### 受動自律エージェント

- 概要
  - 能動的な活動はせず、条件が整うと自己複製する
- ハードウェア
  - HULL
    - 外側
      - なし
    - 内側
      - ASSEMBLER
      - COMPUTER
- ライフサイクル
  - 誕生 → 成長 → 自己複製
- ソフトウェア
  1. HULLは常にエネルギー回収状態で固定
  2. 自己のユニットにダメージがあれば修理する
  3. 自己複製に必要なHULL容量に達するまでHULLを拡張
     - HULL内部に小容量のHULLを生産し、自己のHULLとマージ
  4. 娘個体を生成
     1. 外側に娘HULLを作成
     2. 娘HULLの中にASSEMBLERを生成
     3. 娘HULLの中にCOMPUTERを生成
     4. 娘HULLを分離

### 次バージョン

- 自身の管理下にないユニットと接続を行うためのCONNECTORユニットを追加する
  - これにより、捕食対象と接続して一気にdisassembleする捕食者を実装可能になる
