(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1254:(e,t,s)=>{Promise.resolve().then(s.bind(s,9167))},9167:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>R});var i=s(5155),n=s(2115),r=s(2193);class o{get length(){return null==this._length&&(this._length=Math.sqrt(this.x*this.x+this.y*this.y)),this._length}get lengthSquared(){return null==this._lengthSquared&&(this._lengthSquared=this.x*this.x+this.y*this.y),this._lengthSquared}get normalized(){if(null==this._normalized){let e=this.length;if(0===e)throw Error("Cannot normalize zero vector");this._normalized=this.divide(e)}return this._normalized}constructor(e,t){var s=this;this.x=e,this.y=t,this._length=null,this._lengthSquared=null,this._normalized=null,this.add=e=>new o(this.x+e.x,this.y+e.y),this.subtract=e=>new o(this.x-e.x,this.y-e.y),this.multiply=e=>new o(this.x*e,this.y*e),this.divide=e=>{if(0===e)throw Error("Cannot divide by zero");return new o(this.x/e,this.y/e)},this.negate=()=>new o(-this.x,-this.y),this.dot=e=>this.x*e.x+this.y*e.y,this.cross=e=>this.x*e.y-this.y*e.x,this.distanceTo=e=>this.subtract(e).length,this.distanceSquaredTo=e=>this.subtract(e).lengthSquared,this.angle=()=>Math.atan2(this.y,this.x),this.angleTo=e=>{let t=this.dot(e),s=this.length*e.length;return 0===s?0:Math.acos(Math.max(-1,Math.min(1,t/s)))},this.equals=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.EPSILON;return Math.abs(s.x-e.x)<t&&Math.abs(s.y-e.y)<t},this.isZero=()=>0===this.x&&0===this.y,this.isApproximatelyZero=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.EPSILON;return Math.abs(s.x-0)<e&&Math.abs(s.y-0)<e},this.clone=()=>new o(this.x,this.y)}}o.zero=()=>new o(0,0),o.fromAngle=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new o(Math.cos(e)*t,Math.sin(e)*t)};class a{}class l extends a{isAdjacentTo(e){return this.position.distanceTo(e.position)<=this.radius+e.radius}applyForce(e){null==this.acceleration?this.acceleration=e:this.acceleration=this.acceleration.add(e)}constructor(...e){super(...e),this.acceleration=null}}let c=0,h=()=>{let e=c;return c+=1,e};class u extends l{get weight(){return this.capacity+this.energyAmount}renderPixi(e,t){if(e.circle(this.position.x-this.radius,this.position.y-this.radius,this.radius),e.fill(t.backgroundColor),e.stroke({width:Math.max(4,this.radius/10),color:t.agentColor}),null!=this.saying){let t=this.position.x-this.radius,s=this.position.y-this.radius-this.radius-7,i=new r.EYj({text:this.saying,style:{fontFamily:"Courier New, monospace",fontSize:8,fill:0xffffff,fontWeight:"bold"}});i.x=t,i.y=s,i.anchor.set(.5),e.addChild(i)}}say(e){this.actionReserves.Say={case:"Say",message:e}}move(e){this.actionReserves.Move={case:"Move",power:e}}assemble(e,t){this.actionReserves.Assemble={case:"Assemble",spec:e,transferEnergyAmount:t}}absorb(e,t){this.actionReserves.Absorb={case:"Absorb",targetId:e,amount:t}}transfer(e,t){this.actionReserves.Transfer={case:"Transfer",energyAmount:e,targetId:t}}constructor(e,t){super(),this.position=e,this.type="Agent",this.id=h(),this.velocity=o.zero(),this.actionReserves={},this.saying=null,this.energyAmount=0,this.movePower=t.movePower,this.capacity=t.capacity,this.accessControl=t.accessControl,this.assemblePower=t.assemblePower,this.disassemblePower=t.disassemblePower,this.numberOfConnectors=t.numberOfConnectors,this.movePower=t.movePower,this.senseRange=t.senseRange,this.software=t.software,this.radius=Math.max(Math.sqrt(this.capacity),1),this.maxHits=this.capacity,this.hits=this.maxHits}}let d=e=>"Agent"===e.type,m=e=>Math.ceil(.4*e.capacity+5*e.assemblePower+3*e.disassemblePower+2*e.numberOfConnectors+ +e.movePower+e.senseRange/2),y={resolveMove(e,t,s){let i=s.length,n=e.energyConsumption.requiredEnergyForMovingWeight(t.weight,i);if(n<=t.energyAmount)return{energyConsumption:n,forceToApply:s};let r=e.energyConsumption.maxPowerForMovingWeight(t.weight,t.energyAmount);return{energyConsumption:t.energyAmount,forceToApply:0===s.length?s:s.normalized.multiply(r)}},resolveAssemble(e,t,s,i){let n=m(s);return t.energyAmount<n+i?{canAssemble:!1,assembleEnergyConsumption:0}:{canAssemble:!0,assembleEnergyConsumption:n}}};class g extends a{}class p extends g{run(e){return e-this.createdAt>this.lifetime?{objectsToAdd:[],environmentalObjectsToRemove:[this]}:{objectsToAdd:[],environmentalObjectsToRemove:[]}}renderPixi(e,t){switch(this.traceType.case){case"Line":e.moveTo(this.position.x,this.position.y),e.lineTo(this.traceType.endPoint.x,this.traceType.endPoint.y).stroke({width:this.traceType.size,color:t.energyColor,alpha:.2,alignment:.5});return;case"Block":e.rect(this.position.x-this.radius,this.position.y-this.radius,this.traceType.size,this.traceType.size),e.fill({color:this.traceType.color,alpha:.2});return;default:return}}constructor(e,t,s,i){switch(super(),this.position=e,this.traceType=t,this.createdAt=s,this.lifetime=i,this.type="TraceObject",this.id=h(),this.weight=0,this.velocity=o.zero(),t.case){case"Line":default:this.radius=1;break;case"Block":this.radius=t.size/2}}}class b{get t(){return this._t}addEnvironmentalObject(e){this._environmentalObjects.push(e)}removeEnvironmentalObject(e){let t=this._environmentalObjects.findIndex(t=>t.id===e);t>=0&&this._environmentalObjects.splice(t,1)}addObjects(e){this._objects.push(...e),e.forEach(e=>this._objectsMap.set(e.id,e))}removeObjects(e){e.forEach(e=>{let t=this._objects.findIndex(t=>t.id===e);t>=0&&this._objects.splice(t,1),this._objectsMap.delete(e)})}getObjectById(e){var t;return null!=(t=this._objectsMap.get(e))?t:null}tick(){this._objects.forEach(e=>e.acceleration=null);let e=this._objects.filter(d),t=[],s=[],i=[],n=[],r=this.runReservedAgentActions(e);t.push(...r.objectsToAdd),s.push(...r.objectsToRemove),i.push(...r.environmentalObjectsToAdd),this.updateObjects();let o=this.runEnvironmentalObjects();t.push(...o.objectsToAdd),n.push(...o.environmentalObjectsToRemove),this.runAgents(e),this.removeObjects(s.map(e=>e.id)),n.forEach(e=>this.removeEnvironmentalObject(e.id)),this.addObjects(t),i.forEach(e=>this.addEnvironmentalObject(e)),this._t+=1}runReservedAgentActions(e){let t=[],s=[],i=[];return e.forEach(e=>{if(e.hits<=0)return void s.push(e);e.saying=null,Array.from(Object.values(e.actionReserves)).forEach(n=>{switch(n.case){case"Say":e.saying=n.message;return;case"Move":{let t=y.resolveMove(this.physics,e,n.power);e.energyAmount-=t.energyConsumption,e.applyForce(t.forceToApply);return}case"Assemble":{let s=y.resolveAssemble(this.physics,e,n.spec,n.transferEnergyAmount);if(!0!==s.canAssemble)return;e.energyAmount-=s.assembleEnergyConsumption+n.transferEnergyAmount;let i=new u(e.position.clone(),n.spec);i.energyAmount+=n.transferEnergyAmount,t.push(i);return}case"Absorb":{let t=this.getObjectById(n.targetId);if(null!=t&&"Energy"===t.type&&e.isAdjacentTo(t)){let r=Math.min(Math.min(n.amount,t.amount),e.capacity-e.energyAmount);t.amount-=r,e.energyAmount+=r,t.amount<=.1&&(s.push(t),i.push(new p(t.position.clone(),{case:"Block",size:2*t.radius*.6,color:this.renderTheme.energyColor},this.t,20*r)))}return}case"Transfer":{let t=this.getObjectById(n.targetId);if(null!=t&&"Agent"===t.type){let s=Math.min(Math.min(n.energyAmount,e.energyAmount),t.capacity-t.energyAmount);e.energyAmount-=s,t.energyAmount+=s}return}default:return}}),e.hits-=.05}),{objectsToAdd:t,objectsToRemove:s,environmentalObjectsToAdd:i}}updateObjects(){this._objects.forEach(e=>{e.position=this.normalizedPosition(e.position.add(e.velocity)),e.velocity=this.physics.updatedVelocity(e.velocity),null!=e.acceleration&&(e.velocity=e.velocity.add(this.physics.velocityForPower(e.acceleration,e.weight)))})}normalizedPosition(e){return new o((e.x+this.size.x)%this.size.x,(e.y+this.size.y)%this.size.y)}torusRelativePosition(e,t){let s=t.x-e.x,i=t.y-e.y;return new o(Math.abs(s)<=this.size.x/2?s:s-Math.sign(s)*this.size.x,Math.abs(i)<=this.size.y/2?i:i-Math.sign(i)*this.size.y)}runEnvironmentalObjects(){let e=[],t=[];return this._environmentalObjects.forEach(s=>{let i=s.run(this.t);e.push(...i.objectsToAdd),t.push(...i.environmentalObjectsToRemove)}),{objectsToAdd:e,environmentalObjectsToRemove:t}}runAgents(e){e.forEach(e=>{e.actionReserves={};try{e.software(e,{searchObjects:()=>this.searchObjects(e.position,e.senseRange),searchEnvironmentalObjects:()=>this.searchEnvironmentalObjects(e.position,e.senseRange)})}catch(t){console.log("Agent ".concat(e.id," raises error: ").concat(t))}})}renderPixi(e){e.removeChildren();let t=new r.A1g;t.rect(0,0,this.size.x,this.size.y),t.stroke({width:1,color:6710886}),e.addChild(t),[...this._environmentalObjects,...this._objects].forEach(t=>{let s=new r.A1g;t.renderPixi(s,this.renderTheme),e.addChild(s)})}getObjectCount(){return this._objects.length}searchObjects(e,t){let s=t*t;return this._objects.map(t=>{let s=this.torusRelativePosition(e,t.position);return{object:t,relativePosition:s,distanceSquared:s.lengthSquared}}).filter(e=>e.distanceSquared<=s).map(e=>({id:e.object.id,objectType:e.object.type,position:e.relativePosition,radius:e.object.radius}))}searchEnvironmentalObjects(e,t){let s=t*t;return this._environmentalObjects.map(t=>{let s=this.torusRelativePosition(e,t.position);return{object:t,relativePosition:s,distanceSquared:s.lengthSquared}}).filter(e=>e.distanceSquared<=s).map(e=>({id:e.object.id,objectType:e.object.type,position:e.relativePosition}))}constructor(e,t,s){this.size=e,this.physics=t,this.renderTheme=s,this._t=0,this._environmentalObjects=[],this._objects=[],this._objectsMap=new Map}}class x{requiredEnergyForMovingWeight(e,t){return t*e*this.parameters.moveWeight}maxPowerForMovingWeight(e,t){return t/(e*this.parameters.moveWeight)}constructor(e){this.parameters=e}}class f{frictionForVelocity(e){return this.parameters.frictionForVelocity(e)}updatedVelocity(e){return e.isApproximatelyZero()?e:e.multiply((e.length-this.frictionForVelocity(e.length))/e.length)}velocityForPower(e,t){return e.divide(Math.max(t*this.parameters.inertia,.01))}constructor(e){this.parameters=e,this.energyConsumption=new x(e.energyConsumption)}}let v=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Math.random()*(e-t)+t},j=e=>Math.random()*(e.max-e.min)+e.min;class w extends l{renderPixi(e,t){e.circle(this.position.x-this.radius,this.position.y-this.radius,this.radius),e.fill({color:t.energyColor,alpha:1})}constructor(e,t,s){super(),this.position=e,this.velocity=t,this.amount=s,this.type="Energy",this.id=h(),this.weight=s,this.radius=Math.sqrt(s)}}class A extends g{run(){if(this.cooldown>0)return this.cooldown-=1,{objectsToAdd:[],environmentalObjectsToRemove:[]};let e=Math.floor(j(this.energyAmountRange));this.cooldown=Math.floor(j(this.cooldownRange));let t=j(this.energyProductionDirectionRange),s=o.fromAngle(t*Math.PI/180,j(this.energyProductionVelocityRange));return{objectsToAdd:[new w(this.position,s,e)],environmentalObjectsToRemove:[]}}renderPixi(e,t){e.roundRect(this.position.x-5,this.position.y-5,10,10,2),e.fill(t.energyColor)}constructor(e,t,s,i,n){super(),this.position=e,this.energyAmountRange=t,this.cooldownRange=s,this.energyProductionDirectionRange=i,this.energyProductionVelocityRange=n,this.type="EnergySource",this.id=h(),this.cooldown=0}}let P=e=>(t,s)=>{if(t.energyAmount>.9*t.capacity){let s=Math.max(100,Math.ceil(e+v(200)-100));t.say("✅"),t.assemble({capacity:s,accessControl:"Inaccessible",assemblePower:t.assemblePower,disassemblePower:t.disassemblePower,numberOfConnectors:t.numberOfConnectors,movePower:t.movePower,senseRange:t.senseRange,software:P(s)},Math.floor(.1*t.energyAmount));return}let i=s.searchObjects().filter(e=>"Energy"===e.objectType);i.sort((e,t)=>e.position.length-t.position.length);let n=i[0];null!=n&&(n.position.length<t.radius+n.radius?t.absorb(n.id,t.capacity):t.move(n.position.normalized.multiply(1e-4))),t.say("".concat(Math.ceil(t.energyAmount)))},O=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,s=new u(e,{capacity:t,accessControl:"Inaccessible",assemblePower:2,disassemblePower:2,numberOfConnectors:2,movePower:10,senseRange:100,software:P(t)});return s.energyAmount=.8*s.capacity,s},M={energyConsumption:{moveWeight:1},inertia:0,frictionForVelocity:e=>(1e-4+.004*e)*e},C={backgroundColor:1052688,agentColor:4215396,energyColor:0xffd700},T=(e,t)=>{let s=new f(M),i=new o(e,t),n=new b(i,s,C);n.addEnvironmentalObject(new A(i.multiply(.25),{min:10,max:100},{min:20,max:200},{min:45,max:135},{min:10,max:20})),n.addEnvironmentalObject(new A(i.multiply(.75),{min:1,max:20},{min:1,max:50},{min:240,max:270},{min:20,max:30}));let r=[O(new o(j({min:.65*i.x,max:.85*i.x}),j({min:.1*i.y,max:.4*i.y})),1e3)];return n.addObjects(r),n},E=e=>{let{width:t=800,height:s=600,ticksPerFrame:o=1,isPaused:a=!1,targetTPS:l=60,debugMode:c=!1}=e,h=(0,n.useRef)(null),u=(0,n.useRef)(null),d=(0,n.useRef)(null),m=(0,n.useRef)(a),y=(0,n.useRef)(l);return(0,n.useEffect)(()=>{m.current=a},[a]),(0,n.useEffect)(()=>{y.current=l,null!=u.current&&(u.current.ticker.maxFPS=l)},[l]),(0,n.useEffect)(()=>{if(null!=h.current)return(async()=>{let e=new r.lgM;await e.init({width:t,height:s,backgroundColor:1052688,antialias:!0,resolution:0!==window.devicePixelRatio?window.devicePixelRatio:1,autoDensity:!0}),null!=h.current&&null!=e.canvas&&h.current.appendChild(e.canvas),u.current=e,e.ticker.maxFPS=y.current;let i=T(t,s);d.current=i,console.log("ゲームワールドを初期化しました");let n=new r.mcf;e.stage.addChild(n);let a=new r.A1g;a.rect(5,5,180,120),a.fill({color:0,alpha:.6}),e.stage.addChild(a);let l=new r.EYj({text:"",style:{fontFamily:"Courier New, monospace",fontSize:12,fill:0xffffff}});l.x=10,l.y=10,e.stage.addChild(l);let c=performance.now(),g=0,p=0,b=0,x=0;e.ticker.add(()=>{g++;let e=performance.now();if(e-c>=1e3&&(p=g,x=b,g=0,b=0,c=e),!m.current)for(let e=0;e<o;e++)i.tick(),b++;i.renderPixi(n);let t=i.getObjectCount(),s=m.current?" [PAUSED]":"";l.text="FPS: ".concat(p).concat(s,"\nTPS: ").concat(x," / ").concat(y.current,"\nTick: ").concat(i.t,"\nObjects: ").concat(t)})})(),()=>{null!=u.current&&(u.current.destroy(!0,{children:!0}),u.current=null),d.current=null}},[t,s,o,c]),(0,i.jsx)("div",{className:"flex flex-col items-center gap-4",children:(0,i.jsx)("div",{ref:h,className:"border border-gray-300 rounded-lg"})})};function R(){let[e,t]=(0,n.useState)(!1),[s,r]=(0,n.useState)(0),[o,a]=(0,n.useState)(60),l=e=>{a(Math.max(1,Math.min(120,e)))};return(0,i.jsx)("main",{className:"min-h-screen bg-gray-100",children:(0,i.jsxs)("div",{className:"container mx-auto py-8",children:[(0,i.jsx)("h1",{className:"text-4xl font-bold text-center mb-8",children:"Synthetica Prototype"}),(0,i.jsx)("p",{className:"text-center text-gray-600 mb-8"}),(0,i.jsxs)("div",{className:"mb-8 relative",children:[(0,i.jsx)(E,{width:800,height:600,ticksPerFrame:1,isPaused:e,targetTPS:o,debugMode:!1},s),e&&(0,i.jsx)("div",{className:"absolute inset-0 flex justify-center items-center bg-black bg-opacity-50 rounded-lg pointer-events-none",style:{width:800,height:600},children:(0,i.jsx)("p",{className:"text-white text-2xl font-bold",children:"Paused"})})]}),(0,i.jsx)("div",{className:"flex justify-center",children:(0,i.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,i.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Settings"}),(0,i.jsxs)("div",{className:"mb-4 flex gap-2",children:[(0,i.jsx)("button",{onClick:()=>{t(e=>!e)},className:"px-6 py-2 rounded-lg font-medium transition-colors ".concat(e?"bg-green-500 hover:bg-green-600 text-white":"bg-yellow-500 hover:bg-yellow-600 text-white"),children:e?"Start":"Pause"}),(0,i.jsx)("button",{onClick:()=>{r(e=>e+1),t(!1)},className:"px-6 py-2 rounded-lg font-medium transition-colors bg-red-500 hover:bg-red-600 text-white",children:"Reset"})]}),(0,i.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:e?"Paused":"Running"}),(0,i.jsxs)("div",{className:"border-t pt-4",children:[(0,i.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Simulation Speed: ",o," TPS"]}),(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)("input",{type:"range",min:"1",max:"120",value:o,onChange:e=>l(Number(e.target.value)),className:"flex-1"}),(0,i.jsx)("input",{type:"number",min:"1",max:"120",value:o,onChange:e=>l(Number(e.target.value)),className:"w-16 px-2 py-1 border rounded text-center"})]})]})]})})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[193,441,684,358],()=>t(1254)),_N_E=e.O()}]);